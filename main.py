import streamlit as st
from datetime import datetime

# -------------------- 페이지 설정 --------------------
st.set_page_config(
    page_title="MBTI 진로 추천 (중학생)",
    page_icon="🧭",
    layout="centered"
)

# -------------------- 데이터 --------------------
MBTI_TYPES = [
    "ISTJ","ISFJ","INFJ","INTJ",
    "ISTP","ISFP","INFP","INTP",
    "ESTP","ESFP","ENFP","ENTP",
    "ESTJ","ESFJ","ENFJ","ENTJ",
]

# 각 유형별 추천 직업 3가지와 짧은 이유 (중학생 눈높이, 고정관념 지양)
RECS = {
    "ISTJ": [
        ("도시·교통 설계자", "규칙과 안전을 중시하고 꼼꼼해서 구조를 설계하는 데 강점이 있어요. 🏙️"),
        ("품질 관리 엔지니어", "체계적으로 점검하고 개선점을 찾는 일을 잘해요. 🧪"),
        ("회계·재무 분석가", "숫자와 기록을 정확하게 다루는 능력이 돋보여요. 📊"),
    ],
    "ISFJ": [
        ("임상병리·의료 검사", "세심함과 책임감으로 건강 데이터를 정확히 다뤄요. 🧬"),
        ("유아·특수교육 교사", "배려심으로 학습 환경을 안정적으로 만들어줘요. 🧸"),
        ("보건·영양 관리", "사람들의 생활을 건강하게 돕는 데 보람을 느껴요. 🥗"),
    ],
    "INFJ": [
        ("심리상담·상담교사", "타인의 감정에 공감하고 깊이 있게 돕는 걸 잘해요. 🫶"),
        ("사회혁신 기획자", "가치 있는 변화를 설계하고 꾸준히 추진해요. ♻️"),
        ("콘텐츠 에디터", "메시지를 의미 있게 다듬어 세상에 전해요. ✍️"),
    ],
    "INTJ": [
        ("데이터 사이언티스트", "논리적으로 문제를 분석하고 모델을 설계해요. 🧮"),
        ("R&D 연구원", "장기 목표를 세우고 실험으로 증명해요. 🔬"),
        ("전략기획", "복잡한 정보를 구조화해 의사결정을 돕죠. 🧭"),
    ],
    "ISTP": [
        ("메카트로닉스·로봇 기술", "도구를 잘 다루고 원리를 파악해 고치는 데 능해요. 🤖"),
        ("드론·기계 정비", "문제를 침착하게 진단하고 해결해요. 🔧"),
        ("산업안전·현장기술", "현장에서 빠르게 판단하고 실천해요. 🦺"),
    ],
    "ISFP": [
        ("그래픽·제품 디자이너", "감각적으로 아름다움을 구현해요. 🎨"),
        ("작업치료·재활보조", "따뜻함과 손기술로 일상 회복을 돕죠. 🧩"),
        ("사진·영상 크리에이터", "섬세한 시선으로 스토리를 담아요. 📸"),
    ],
    "INFP": [
        ("작가·시나리오", "상상력과 가치관을 글로 표현해요. 📖"),
        ("사회복지·국제개발", "도움이 필요한 사람에게 힘이 돼요. 🤝"),
        ("UX 라이터·콘텐츠 플래너", "사용자 입장에서 친절한 경험을 설계해요. 🧑\u200d💻"),
    ],
    "INTP": [
        ("소프트웨어 개발자", "원리를 파고들며 효율적 코드를 만듭니다. 💻"),
        ("시스템 설계자", "복잡한 구조를 추상화해 모델링해요. 🧠"),
        ("리서치 애널리스트", "가설을 세우고 데이터로 검증해요. 📐"),
    ],
    "ESTP": [
        ("스포츠 트레이너·코치", "현장 판단이 빠르고 실행력이 뛰어나요. 🏃"),
        ("세일즈·사업개발", "상황 파악과 설득에 강점이 있어요. 💼"),
        ("응급구조·재난대응", "결단력으로 위기에서 행동해요. 🚑"),
    ],
    "ESFP": [
        ("공연·방송 엔터테인먼트", "사람들에게 에너지를 전하는 재능이 있어요. 🎤"),
        ("행사·이벤트 플래너", "현장 분위기를 읽고 즐거움을 만들어요. 🎪"),
        ("호텔·관광 서비스", "친절함으로 멋진 경험을 선물해요. 🏨"),
    ],
    "ENFP": [
        ("브랜드·마케팅 기획", "아이디어를 모아 설렘을 현실로! ✨"),
        ("소셜벤처 창업", "가치와 재미를 함께 추구해요. 🚀"),
        ("교육 크리에이터", "재미있는 배움 콘텐츠를 만들어요. 🧑\u200d🏫"),
    ],
    "ENTP": [
        ("제품·서비스 기획", "새로운 가능성을 실험하고 개선해요. 🧪"),
        ("스타트업 창업", "변화를 즐기며 빠르게 피봇해요. 🚀"),
        ("정책·미래전략 분석", "다양한 관점을 연결해 해법을 제시해요. 🔭"),
    ],
    "ESTJ": [
        ("프로젝트 매니저", "사람과 일정을 조직적으로 이끌어요. 📅"),
        ("공공행정·행정사무", "규정을 바탕으로 공정하게 운영해요. 🏛️"),
        ("생산관리·오퍼레이션", "효율을 개선하고 성과를 만듭니다. ⚙️"),
    ],
    "ESFJ": [
        ("간호·보건 서비스", "세심함과 헌신으로 돌봄을 실천해요. 🩺"),
        ("학교행정·교육지원", "협력으로 학교 생활을 원활히 돕죠. 📝"),
        ("인사·교육 트레이너", "사람들의 성장을 체계적으로 지원해요. 🌱"),
    ],
    "ENFJ": [
        ("교사·교육 리더", "잠재력을 끌어내고 팀을 성장시켜요. 📚"),
        ("CSR·비영리 기획", "공익 프로젝트를 설계하고 연결해요. 🤝"),
        ("조직문화·HRD", "함께 일하는 방식을 더 좋게 만들어요. 🧩"),
    ],
    "ENTJ": [
        ("경영컨설턴트", "큰 그림을 그리고 실행전략을 만듭니다. 🧭"),
        ("제품 총괄(PM)", "목표를 세우고 팀을 이끌어 성과를 내요. 🎯"),
        ("투자·벤처캐피탈", "데이터로 판단하고 과감히 결정해요. 💹"),
    ],
}

SUBJECT_HINTS = {
    "과학": ["생명과학", "화학", "물리", "지구과학"],
    "공학·기술": ["기술·가정", "정보", "기계/전기 기초"],
    "인문": ["국어", "역사", "윤리"],
    "사회": ["사회", "경제", "정치와 법 기초"],
    "예술": ["미술", "음악", "영상 제작"],
    "체육": ["체육", "보건"],
    "외국어": ["영어", "제2외국어"]
}

# 유형별 추천 과목 키워드(간단 매핑)
HINT_MAP = {
    "ISTJ": ["수학", "물리", "정보"],
    "ISFJ": ["생명과학", "보건", "윤리"],
    "INFJ": ["국어", "윤리", "사회"],
    "INTJ": ["수학", "물리", "정보"],
    "ISTP": ["기술·가정", "물리", "정보"],
    "ISFP": ["미술", "음악", "국어"],
    "INFP": ["국어", "사회", "미술"],
    "INTP": ["수학", "정보", "물리"],
    "ESTP": ["체육", "기술·가정", "사회"],
    "ESFP": ["음악", "미술", "체육"],
    "ENFP": ["국어", "사회", "음악"],
    "ENTP": ["사회", "정보", "수학"],
    "ESTJ": ["수학", "사회", "기술·가정"],
    "ESFJ": ["보건", "사회", "국어"],
    "ENFJ": ["국어", "사회", "윤리"],
    "ENTJ": ["수학", "사회", "정보"],
}

# -------------------- 사이드바 --------------------
with st.sidebar:
    st.markdown("## 🧭 MBTI 진로 추천")
    st.markdown(
        """
        **주의:** MBTI는 *성격 경향*을 간단히 보는 도구일 뿐, 
        능력이나 적성을 단정하지 않아요. 🙂  
        궁금한 직업이 있으면 **직접 탐색**해 보는 게 제일 좋아요!
        """
    )
    st.markdown("—")
    st.markdown("""**활용 팁**  
    1) 추천 이유를 읽고 *왜 나와 맞는지* 스스로 적어보기  
    2) 관심 과목을 1개 골라 이번 주에 *작은 실험* 해보기  
    3) 담임·진로선생님과 대화로 확장하기""")

# -------------------- 본문 --------------------
st.title("중학생 MBTI 기반 진로 추천 프로그램 ✨")
st.caption("Made with Streamlit · 마지막 업데이트: " + datetime.now().strftime("%Y-%m-%d"))

col1, col2 = st.columns([1,1])
with col1:
    mbti = st.selectbox("내 MBTI를 골라주세요", MBTI_TYPES, index=MBTI_TYPES.index("ENFP"))
with col2:
    show_subjects = st.toggle("관심 과목 힌트 보기 📚", value=True)

st.markdown(":sparkles: **{0}** 유형에게 어울리는 미래 직업 아이디어".format(mbti))

recs = RECS.get(mbti, [])
for i, (job, why) in enumerate(recs, start=1):
    st.markdown(f"**{i}. {job}** — {why}")

if show_subjects:
    st.markdown("\n**공부 힌트(과목 키워드)** 🧩")
    hints = HINT_MAP.get(mbti, [])
    st.markdown(", ".join([f"`{h}`" for h in hints]))

# 작게: 오늘의 질문
st.markdown("\n> 💡 *오늘의 질문:* 이 직업과 관련해 **내가 이미 잘하는 점 1가지**는?")

# 다운로드 버튼(텍스트)
export_text = [
    "MBTI 진로 추천 (중학생)",
    f"선택한 유형: {mbti}",
    "추천 직업:",
]
export_text += [f"- {title}: {desc}" for (title, desc) in recs]
if show_subjects:
    export_text.append("공부 힌트: " + ", ".join(HINT_MAP.get(mbti, [])))

st.download_button(
    label="추천 결과 저장하기 ⬇️",
    data="\n".join(export_text),
    file_name=f"mbti_career_{mbti}.txt",
    mime="text/plain",
)

# 푸터
st.markdown("—")
st.markdown(
    """
    📝 *주의:* 어떤 유형이든 **원하는 진로를 선택할 자유**가 있어요.  
    이 결과는 *참고용*이며, 실제 적성과 흥미는 **경험과 학습**으로 더 잘 알 수 있어요.
    """
)
